{"ast":null,"code":"/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { deepEqual } from '../utils/deep-equal'; // Adapted from https://github.com/mapbox/mapbox-gl-js/blob/v1.13.0/src/ui/popup.js\n\nfunction getClassList(className) {\n  return new Set(className ? className.trim().split(/\\s+/) : []);\n}\n/* eslint-disable complexity,max-statements */\n\n\nfunction Popup(props) {\n  const {\n    map,\n    mapLib\n  } = useContext(MapContext);\n  const container = useMemo(() => {\n    return document.createElement('div');\n  }, []);\n  const thisRef = useRef({\n    props\n  });\n  thisRef.current.props = props;\n  const popup = useMemo(() => {\n    const options = { ...props\n    };\n    const pp = new mapLib.Popup(options).setLngLat([props.longitude, props.latitude]);\n    pp.once('open', e => {\n      var _a, _b;\n\n      (_b = (_a = thisRef.current.props).onOpen) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n    });\n    return pp;\n  }, []);\n  useEffect(() => {\n    const onClose = e => {\n      var _a, _b;\n\n      (_b = (_a = thisRef.current.props).onClose) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n    };\n\n    popup.on('close', onClose);\n    popup.setDOMContent(container).addTo(map.getMap());\n    return () => {\n      // https://github.com/visgl/react-map-gl/issues/1825\n      // onClose should not be fired if the popup is removed by unmounting\n      // When using React strict mode, the component is mounted twice.\n      // Firing the onClose callback here would be a false signal to remove the component.\n      popup.off('close', onClose);\n\n      if (popup.isOpen()) {\n        popup.remove();\n      }\n    };\n  }, []);\n  useEffect(() => {\n    applyReactStyle(popup.getElement(), props.style);\n  }, [props.style]);\n\n  if (popup.isOpen()) {\n    if (popup.getLngLat().lng !== props.longitude || popup.getLngLat().lat !== props.latitude) {\n      popup.setLngLat([props.longitude, props.latitude]);\n    } // @ts-ignore\n\n\n    if (props.offset && !deepEqual(popup.options.offset, props.offset)) {\n      popup.setOffset(props.offset);\n    } // @ts-ignore\n\n\n    if (popup.options.anchor !== props.anchor || popup.options.maxWidth !== props.maxWidth) {\n      // @ts-ignore\n      popup.options.anchor = props.anchor;\n      popup.setMaxWidth(props.maxWidth);\n    } // @ts-ignore\n\n\n    if (popup.options.className !== props.className) {\n      // @ts-ignore\n      const prevClassList = getClassList(popup.options.className);\n      const nextClassList = getClassList(props.className);\n\n      for (const c of prevClassList) {\n        if (!nextClassList.has(c)) {\n          popup.removeClassName(c);\n        }\n      }\n\n      for (const c of nextClassList) {\n        if (!prevClassList.has(c)) {\n          popup.addClassName(c);\n        }\n      } // @ts-ignore\n\n\n      popup.options.className = props.className;\n    }\n  }\n\n  return createPortal(props.children, container);\n} // @ts-ignore\n\n\nexport default React.memo(Popup);","map":{"version":3,"sources":["../../../src/components/popup.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { deepEqual } from '../utils/deep-equal';\n// Adapted from https://github.com/mapbox/mapbox-gl-js/blob/v1.13.0/src/ui/popup.js\nfunction getClassList(className) {\n    return new Set(className ? className.trim().split(/\\s+/) : []);\n}\n/* eslint-disable complexity,max-statements */\nfunction Popup(props) {\n    const { map, mapLib } = useContext(MapContext);\n    const container = useMemo(() => {\n        return document.createElement('div');\n    }, []);\n    const thisRef = useRef({ props });\n    thisRef.current.props = props;\n    const popup = useMemo(() => {\n        const options = { ...props };\n        const pp = new mapLib.Popup(options).setLngLat([props.longitude, props.latitude]);\n        pp.once('open', e => {\n            var _a, _b;\n            (_b = (_a = thisRef.current.props).onOpen) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n        });\n        return pp;\n    }, []);\n    useEffect(() => {\n        const onClose = e => {\n            var _a, _b;\n            (_b = (_a = thisRef.current.props).onClose) === null || _b === void 0 ? void 0 : _b.call(_a, e);\n        };\n        popup.on('close', onClose);\n        popup.setDOMContent(container).addTo(map.getMap());\n        return () => {\n            // https://github.com/visgl/react-map-gl/issues/1825\n            // onClose should not be fired if the popup is removed by unmounting\n            // When using React strict mode, the component is mounted twice.\n            // Firing the onClose callback here would be a false signal to remove the component.\n            popup.off('close', onClose);\n            if (popup.isOpen()) {\n                popup.remove();\n            }\n        };\n    }, []);\n    useEffect(() => {\n        applyReactStyle(popup.getElement(), props.style);\n    }, [props.style]);\n    if (popup.isOpen()) {\n        if (popup.getLngLat().lng !== props.longitude || popup.getLngLat().lat !== props.latitude) {\n            popup.setLngLat([props.longitude, props.latitude]);\n        }\n        // @ts-ignore\n        if (props.offset && !deepEqual(popup.options.offset, props.offset)) {\n            popup.setOffset(props.offset);\n        }\n        // @ts-ignore\n        if (popup.options.anchor !== props.anchor || popup.options.maxWidth !== props.maxWidth) {\n            // @ts-ignore\n            popup.options.anchor = props.anchor;\n            popup.setMaxWidth(props.maxWidth);\n        }\n        // @ts-ignore\n        if (popup.options.className !== props.className) {\n            // @ts-ignore\n            const prevClassList = getClassList(popup.options.className);\n            const nextClassList = getClassList(props.className);\n            for (const c of prevClassList) {\n                if (!nextClassList.has(c)) {\n                    popup.removeClassName(c);\n                }\n            }\n            for (const c of nextClassList) {\n                if (!prevClassList.has(c)) {\n                    popup.addClassName(c);\n                }\n            }\n            // @ts-ignore\n            popup.options.className = props.className;\n        }\n    }\n    return createPortal(props.children, container);\n}\n// @ts-ignore\nexport default React.memo(Popup);\n//# sourceMappingURL=popup.js.map"]},"metadata":{},"sourceType":"module"}