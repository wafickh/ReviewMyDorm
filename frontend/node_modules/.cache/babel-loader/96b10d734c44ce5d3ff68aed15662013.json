{"ast":null,"code":"/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { arePointsEqual } from '../utils/deep-equal';\nconst defaultProps = {\n  draggable: false,\n  popup: null,\n  rotation: 0,\n  rotationAlignment: 'auto',\n  pitchAlignment: 'auto'\n};\n/* eslint-disable complexity,max-statements */\n\nfunction Marker(props) {\n  const {\n    map,\n    mapLib\n  } = useContext(MapContext);\n  const thisRef = useRef({\n    props\n  });\n  thisRef.current.props = props;\n  const marker = useMemo(() => {\n    let hasChildren = false;\n    React.Children.forEach(props.children, el => {\n      if (el) {\n        hasChildren = true;\n      }\n    });\n    const options = { ...props,\n      element: hasChildren ? document.createElement('div') : null\n    };\n    const mk = new mapLib.Marker(options).setLngLat([props.longitude, props.latitude]);\n    mk.getElement().addEventListener('click', e => {\n      var _a, _b;\n\n      (_b = (_a = thisRef.current.props).onClick) === null || _b === void 0 ? void 0 : _b.call(_a, {\n        type: 'click',\n        target: mk,\n        originalEvent: e\n      });\n    });\n    mk.on('dragstart', e => {\n      var _a, _b;\n\n      const evt = e;\n      evt.lngLat = marker.getLngLat();\n      (_b = (_a = thisRef.current.props).onDragStart) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n    });\n    mk.on('drag', e => {\n      var _a, _b;\n\n      const evt = e;\n      evt.lngLat = marker.getLngLat();\n      (_b = (_a = thisRef.current.props).onDrag) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n    });\n    mk.on('dragend', e => {\n      var _a, _b;\n\n      const evt = e;\n      evt.lngLat = marker.getLngLat();\n      (_b = (_a = thisRef.current.props).onDragEnd) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n    });\n    return mk;\n  }, []);\n  useEffect(() => {\n    marker.addTo(map.getMap());\n    return () => {\n      marker.remove();\n    };\n  }, []);\n  useEffect(() => {\n    applyReactStyle(marker.getElement(), props.style);\n  }, [props.style]);\n\n  if (marker.getLngLat().lng !== props.longitude || marker.getLngLat().lat !== props.latitude) {\n    marker.setLngLat([props.longitude, props.latitude]);\n  }\n\n  if (props.offset && !arePointsEqual(marker.getOffset(), props.offset)) {\n    marker.setOffset(props.offset);\n  }\n\n  if (marker.isDraggable() !== props.draggable) {\n    marker.setDraggable(props.draggable);\n  }\n\n  if (marker.getRotation() !== props.rotation) {\n    marker.setRotation(props.rotation);\n  }\n\n  if (marker.getRotationAlignment() !== props.rotationAlignment) {\n    marker.setRotationAlignment(props.rotationAlignment);\n  }\n\n  if (marker.getPitchAlignment() !== props.pitchAlignment) {\n    marker.setPitchAlignment(props.pitchAlignment);\n  }\n\n  if (marker.getPopup() !== props.popup) {\n    marker.setPopup(props.popup);\n  }\n\n  return createPortal(props.children, marker.getElement());\n}\n\nMarker.defaultProps = defaultProps; // @ts-ignore\n\nexport default React.memo(Marker);","map":{"version":3,"sources":["../../../src/components/marker.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { arePointsEqual } from '../utils/deep-equal';\nconst defaultProps = {\n    draggable: false,\n    popup: null,\n    rotation: 0,\n    rotationAlignment: 'auto',\n    pitchAlignment: 'auto'\n};\n/* eslint-disable complexity,max-statements */\nfunction Marker(props) {\n    const { map, mapLib } = useContext(MapContext);\n    const thisRef = useRef({ props });\n    thisRef.current.props = props;\n    const marker = useMemo(() => {\n        let hasChildren = false;\n        React.Children.forEach(props.children, el => {\n            if (el) {\n                hasChildren = true;\n            }\n        });\n        const options = {\n            ...props,\n            element: hasChildren ? document.createElement('div') : null\n        };\n        const mk = new mapLib.Marker(options).setLngLat([props.longitude, props.latitude]);\n        mk.getElement().addEventListener('click', (e) => {\n            var _a, _b;\n            (_b = (_a = thisRef.current.props).onClick) === null || _b === void 0 ? void 0 : _b.call(_a, {\n                type: 'click',\n                target: mk,\n                originalEvent: e\n            });\n        });\n        mk.on('dragstart', e => {\n            var _a, _b;\n            const evt = e;\n            evt.lngLat = marker.getLngLat();\n            (_b = (_a = thisRef.current.props).onDragStart) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n        });\n        mk.on('drag', e => {\n            var _a, _b;\n            const evt = e;\n            evt.lngLat = marker.getLngLat();\n            (_b = (_a = thisRef.current.props).onDrag) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n        });\n        mk.on('dragend', e => {\n            var _a, _b;\n            const evt = e;\n            evt.lngLat = marker.getLngLat();\n            (_b = (_a = thisRef.current.props).onDragEnd) === null || _b === void 0 ? void 0 : _b.call(_a, evt);\n        });\n        return mk;\n    }, []);\n    useEffect(() => {\n        marker.addTo(map.getMap());\n        return () => {\n            marker.remove();\n        };\n    }, []);\n    useEffect(() => {\n        applyReactStyle(marker.getElement(), props.style);\n    }, [props.style]);\n    if (marker.getLngLat().lng !== props.longitude || marker.getLngLat().lat !== props.latitude) {\n        marker.setLngLat([props.longitude, props.latitude]);\n    }\n    if (props.offset && !arePointsEqual(marker.getOffset(), props.offset)) {\n        marker.setOffset(props.offset);\n    }\n    if (marker.isDraggable() !== props.draggable) {\n        marker.setDraggable(props.draggable);\n    }\n    if (marker.getRotation() !== props.rotation) {\n        marker.setRotation(props.rotation);\n    }\n    if (marker.getRotationAlignment() !== props.rotationAlignment) {\n        marker.setRotationAlignment(props.rotationAlignment);\n    }\n    if (marker.getPitchAlignment() !== props.pitchAlignment) {\n        marker.setPitchAlignment(props.pitchAlignment);\n    }\n    if (marker.getPopup() !== props.popup) {\n        marker.setPopup(props.popup);\n    }\n    return createPortal(props.children, marker.getElement());\n}\nMarker.defaultProps = defaultProps;\n// @ts-ignore\nexport default React.memo(Marker);\n//# sourceMappingURL=marker.js.map"]},"metadata":{},"sourceType":"module"}