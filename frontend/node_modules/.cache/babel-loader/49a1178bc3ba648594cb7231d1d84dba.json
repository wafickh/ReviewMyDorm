{"ast":null,"code":"import * as React from 'react';\nimport { useState, useRef, useEffect, useContext, useMemo, forwardRef, useImperativeHandle } from 'react';\nimport { MountedMapsContext } from './use-map';\nimport Mapbox from '../mapbox/mapbox';\nimport createRef from '../mapbox/create-ref';\nimport useIsomorphicLayoutEffect from '../utils/use-isomorphic-layout-effect';\nimport setGlobals from '../utils/set-globals';\nexport const MapContext = React.createContext(null);\nconst defaultProps = {\n  // Constraints\n  minZoom: 0,\n  maxZoom: 22,\n  minPitch: 0,\n  maxPitch: 60,\n  // Interaction handlers\n  scrollZoom: true,\n  boxZoom: true,\n  dragRotate: true,\n  dragPan: true,\n  keyboard: true,\n  doubleClickZoom: true,\n  touchZoomRotate: true,\n  touchPitch: true,\n  // Style\n  mapStyle: {\n    version: 8,\n    sources: {},\n    layers: []\n  },\n  styleDiffing: true,\n  projection: 'mercator',\n  renderWorldCopies: true,\n  // Callbacks\n  onError: e => console.error(e.error),\n  // Globals\n  RTLTextPlugin: 'https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js'\n};\nconst Map = forwardRef((props, ref) => {\n  const mountedMapsContext = useContext(MountedMapsContext);\n  const [mapInstance, setMapInstance] = useState(null);\n  const containerRef = useRef();\n  const {\n    current: contextValue\n  } = useRef({\n    mapLib: null,\n    map: null\n  });\n  useEffect(() => {\n    const mapLib = props.mapLib;\n    let isMounted = true;\n    let mapbox;\n    Promise.resolve(mapLib || import('mapbox-gl')).then(mapboxgl => {\n      if (!isMounted) {\n        return;\n      }\n\n      if (!mapboxgl.Map) {\n        // commonjs style\n        mapboxgl = mapboxgl.default;\n      }\n\n      if (!mapboxgl || !mapboxgl.Map) {\n        throw new Error('Invalid mapLib');\n      }\n\n      if (mapboxgl.supported(props)) {\n        setGlobals(mapboxgl, props);\n\n        if (props.reuseMaps) {\n          mapbox = Mapbox.reuse(props, containerRef.current);\n        }\n\n        if (!mapbox) {\n          mapbox = new Mapbox(mapboxgl.Map, props, containerRef.current);\n        }\n\n        contextValue.map = createRef(mapbox, mapboxgl);\n        contextValue.mapLib = mapboxgl;\n        setMapInstance(mapbox);\n        mountedMapsContext === null || mountedMapsContext === void 0 ? void 0 : mountedMapsContext.onMapMount(contextValue.map, props.id);\n      } else {\n        throw new Error('Map is not supported by this browser');\n      }\n    }).catch(error => {\n      props.onError({\n        type: 'error',\n        target: null,\n        originalEvent: null,\n        error\n      });\n    });\n    return () => {\n      isMounted = false;\n\n      if (mapbox) {\n        mountedMapsContext === null || mountedMapsContext === void 0 ? void 0 : mountedMapsContext.onMapUnmount(props.id);\n\n        if (props.reuseMaps) {\n          mapbox.recycle();\n        } else {\n          mapbox.destroy();\n        }\n      }\n    };\n  }, []);\n  useIsomorphicLayoutEffect(() => {\n    if (mapInstance) {\n      mapInstance.setProps(props);\n    }\n  });\n  useImperativeHandle(ref, () => contextValue.map, [mapInstance]);\n  const style = useMemo(() => ({\n    position: 'relative',\n    width: '100%',\n    height: '100%',\n    ...props.style\n  }), [props.style]);\n  return React.createElement(\"div\", {\n    id: props.id,\n    ref: containerRef,\n    style: style\n  }, mapInstance && React.createElement(MapContext.Provider, {\n    value: contextValue\n  }, React.createElement(\"div\", {\n    \"mapboxgl-children\": \"\"\n  }, props.children)));\n});\nMap.displayName = 'Map';\nMap.defaultProps = defaultProps;\nexport default Map;","map":{"version":3,"sources":["../../../src/components/map.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import * as React from 'react';\nimport { useState, useRef, useEffect, useContext, useMemo, forwardRef, useImperativeHandle } from 'react';\nimport { MountedMapsContext } from './use-map';\nimport Mapbox from '../mapbox/mapbox';\nimport createRef from '../mapbox/create-ref';\nimport useIsomorphicLayoutEffect from '../utils/use-isomorphic-layout-effect';\nimport setGlobals from '../utils/set-globals';\nexport const MapContext = React.createContext(null);\nconst defaultProps = {\n    // Constraints\n    minZoom: 0,\n    maxZoom: 22,\n    minPitch: 0,\n    maxPitch: 60,\n    // Interaction handlers\n    scrollZoom: true,\n    boxZoom: true,\n    dragRotate: true,\n    dragPan: true,\n    keyboard: true,\n    doubleClickZoom: true,\n    touchZoomRotate: true,\n    touchPitch: true,\n    // Style\n    mapStyle: { version: 8, sources: {}, layers: [] },\n    styleDiffing: true,\n    projection: 'mercator',\n    renderWorldCopies: true,\n    // Callbacks\n    onError: e => console.error(e.error),\n    // Globals\n    RTLTextPlugin: 'https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js'\n};\nconst Map = forwardRef((props, ref) => {\n    const mountedMapsContext = useContext(MountedMapsContext);\n    const [mapInstance, setMapInstance] = useState(null);\n    const containerRef = useRef();\n    const { current: contextValue } = useRef({ mapLib: null, map: null });\n    useEffect(() => {\n        const mapLib = props.mapLib;\n        let isMounted = true;\n        let mapbox;\n        Promise.resolve(mapLib || import('mapbox-gl'))\n            .then(mapboxgl => {\n            if (!isMounted) {\n                return;\n            }\n            if (!mapboxgl.Map) {\n                // commonjs style\n                mapboxgl = mapboxgl.default;\n            }\n            if (!mapboxgl || !mapboxgl.Map) {\n                throw new Error('Invalid mapLib');\n            }\n            if (mapboxgl.supported(props)) {\n                setGlobals(mapboxgl, props);\n                if (props.reuseMaps) {\n                    mapbox = Mapbox.reuse(props, containerRef.current);\n                }\n                if (!mapbox) {\n                    mapbox = new Mapbox(mapboxgl.Map, props, containerRef.current);\n                }\n                contextValue.map = createRef(mapbox, mapboxgl);\n                contextValue.mapLib = mapboxgl;\n                setMapInstance(mapbox);\n                mountedMapsContext === null || mountedMapsContext === void 0 ? void 0 : mountedMapsContext.onMapMount(contextValue.map, props.id);\n            }\n            else {\n                throw new Error('Map is not supported by this browser');\n            }\n        })\n            .catch(error => {\n            props.onError({\n                type: 'error',\n                target: null,\n                originalEvent: null,\n                error\n            });\n        });\n        return () => {\n            isMounted = false;\n            if (mapbox) {\n                mountedMapsContext === null || mountedMapsContext === void 0 ? void 0 : mountedMapsContext.onMapUnmount(props.id);\n                if (props.reuseMaps) {\n                    mapbox.recycle();\n                }\n                else {\n                    mapbox.destroy();\n                }\n            }\n        };\n    }, []);\n    useIsomorphicLayoutEffect(() => {\n        if (mapInstance) {\n            mapInstance.setProps(props);\n        }\n    });\n    useImperativeHandle(ref, () => contextValue.map, [mapInstance]);\n    const style = useMemo(() => ({\n        position: 'relative',\n        width: '100%',\n        height: '100%',\n        ...props.style\n    }), [props.style]);\n    return (React.createElement(\"div\", { id: props.id, ref: containerRef, style: style }, mapInstance && (React.createElement(MapContext.Provider, { value: contextValue },\n        React.createElement(\"div\", { \"mapboxgl-children\": \"\" }, props.children)))));\n});\nMap.displayName = 'Map';\nMap.defaultProps = defaultProps;\nexport default Map;\n//# sourceMappingURL=map.js.map"]},"metadata":{},"sourceType":"module"}